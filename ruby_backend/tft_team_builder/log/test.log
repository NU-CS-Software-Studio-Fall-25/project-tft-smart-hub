  [1m[35m (13.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.7ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 20:06:10.647331', '2025-10-12 20:06:10.647331', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 20:06:10.647331', '2025-10-12 20:06:10.647331', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 20:06:10.657333', '2025-10-12 20:06:10.657333', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 20:06:10.657333', '2025-10-12 20:06:10.657333', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (10.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.7ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 13:06:12 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 13:06:12 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.7ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.4ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 13:06:12 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.6ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 1.8ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 13:06:12 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 13:06:12 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.6ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 20:06:12.844025"], ["updated_at", "2025-10-12 20:06:12.844025"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 4ms (Views: 0.1ms | ActiveRecord: 1.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.8ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 20:23:11.379127', '2025-10-12 20:23:11.379127', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 20:23:11.379127', '2025-10-12 20:23:11.379127', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 20:23:11.389285', '2025-10-12 20:23:11.389285', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 20:23:11.389285', '2025-10-12 20:23:11.389285', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.5ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 13:23:11 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.6ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 20:23:11.630964"], ["updated_at", "2025-10-12 20:23:11.630964"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.6ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 22ms (Views: 0.3ms | ActiveRecord: 2.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 13:23:11 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 13:23:11 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 13:23:11 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 13:23:11 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (4.1ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 21:34:29.762430', '2025-10-12 21:34:29.762430', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 21:34:29.762430', '2025-10-12 21:34:29.762430', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 21:34:29.775934', '2025-10-12 21:34:29.775934', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 21:34:29.775934', '2025-10-12 21:34:29.775934', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.9ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.4ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.8ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:34:29 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (1.0ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 21:34:30.070566"], ["updated_at", "2025-10-12 21:34:30.070566"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.8ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 14ms (Views: 0.6ms | ActiveRecord: 3.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:34:30 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.8ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 1.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 14:34:30 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 0.8ms | ActiveRecord: 1.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 14:34:30 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 14:34:30 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (6.0ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 21:35:47.083183', '2025-10-12 21:35:47.083183', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 21:35:47.083183', '2025-10-12 21:35:47.083183', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 21:35:47.099881', '2025-10-12 21:35:47.099881', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 21:35:47.099881', '2025-10-12 21:35:47.099881', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (11.1ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:35:47 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (1.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.8ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 61ms (Views: 1.7ms | ActiveRecord: 2.8ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (1.0ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 14:35:47 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 6ms (Views: 1.6ms | ActiveRecord: 1.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.5ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:35:47 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.4ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (1.3ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 21:35:47.639674"], ["updated_at", "2025-10-12 21:35:47.639674"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 9ms (Views: 1.3ms | ActiveRecord: 2.7ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.9ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.4ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 14:35:47 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 14:35:47 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (1.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (4.5ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 21:42:39.975127', '2025-10-12 21:42:39.975127', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 21:42:39.975127', '2025-10-12 21:42:39.975127', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 21:42:39.986230', '2025-10-12 21:42:39.986230', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 21:42:39.986230', '2025-10-12 21:42:39.986230', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (23.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (10.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 14:42:40 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (1.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 21ms (Views: 0.2ms | ActiveRecord: 1.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.8ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 14:42:40 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.8ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:42:40 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.6ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.7ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 21:42:40.316920"], ["updated_at", "2025-10-12 21:42:40.316920"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.7ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 9ms (Views: 1.2ms | ActiveRecord: 2.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 14:42:40 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.7ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 5ms (Views: 1.2ms | ActiveRecord: 1.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 14:42:40 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.5ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.8ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 1.2ms | ActiveRecord: 1.6ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.6ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-12 22:09:19.172380', '2025-10-12 22:09:19.172380', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-12 22:09:19.172380', '2025-10-12 22:09:19.172380', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-12 22:09:19.182995', '2025-10-12 22:09:19.182995', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-12 22:09:19.182995', '2025-10-12 22:09:19.182995', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.3ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mChampion Load (0.7ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 15:09:19 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.5ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.6ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 12ms (Views: 0.6ms | ActiveRecord: 1.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 15:09:19 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 15:09:19 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mChampion Pluck (0.4ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.5ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-12 22:09:19.476471"], ["updated_at", "2025-10-12 22:09:19.476471"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 4ms (Views: 0.4ms | ActiveRecord: 1.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 15:09:19 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 15:09:19 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (4.3ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-13 00:14:17.330577', '2025-10-13 00:14:17.330577', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-13 00:14:17.330577', '2025-10-13 00:14:17.330577', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-13 00:14:17.340882', '2025-10-13 00:14:17.340882', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-13 00:14:17.340882', '2025-10-13 00:14:17.340882', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mUser Delete All (1.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.461686"], ["updated_at", "2025-10-13 00:14:17.461686"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.466142"], ["updated_at", "2025-10-13 00:14:17.466142"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (1.0ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.5ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 12ms (Views: 0.4ms | ActiveRecord: 1.5ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
Api::TeamCompsControllerTest: test_update_requires_admin
--------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.665583"], ["updated_at", "2025-10-13 00:14:17.665583"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.668647"], ["updated_at", "2025-10-13 00:14:17.668647"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.683986"], ["updated_at", "2025-10-13 00:14:17.683986"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.687750"], ["updated_at", "2025-10-13 00:14:17.687750"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.4ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.699958"], ["updated_at", "2025-10-13 00:14:17.699958"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.702648"], ["updated_at", "2025-10-13 00:14:17.702648"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Api::TeamCompsControllerTest - test_create_comp_from_champion_ids: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
Api::AuthControllerTest: test_register_creates_user_and_returns_token
---------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
Started POST "/api/auth/register" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::AuthControllerTest: test_login_returns_token_for_valid_credentials
-----------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:14:17.746929"], ["updated_at", "2025-10-13 00:14:17.746929"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/api/auth/login" for 127.0.0.1 at 2025-10-12 17:14:17 -0700
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.2ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-13 00:15:23.486521', '2025-10-13 00:15:23.486521', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-13 00:15:23.486521', '2025-10-13 00:15:23.486521', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-13 00:15:23.497839', '2025-10-13 00:15:23.497839', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-13 00:15:23.497839', '2025-10-13 00:15:23.497839', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
Api::AuthControllerTest: test_register_creates_user_and_returns_token
---------------------------------------------------------------------
  [1m[36mUser Delete All (1.7ms)[0m  [1m[31mDELETE FROM "users"[0m
Started POST "/api/auth/register" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::AuthController#register as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.794527"], ["updated_at", "2025-10-13 00:15:23.794527"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 28ms (Views: 0.5ms | ActiveRecord: 6.5ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::AuthControllerTest: test_login_returns_token_for_valid_credentials
-----------------------------------------------------------------------
  [1m[36mUser Delete All (0.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.823430"], ["updated_at", "2025-10-13 00:15:23.823430"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/api/auth/login" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::AuthController#login as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
Api::TeamCompsControllerTest: test_update_requires_admin
--------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.852807"], ["updated_at", "2025-10-13 00:15:23.852807"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.855470"], ["updated_at", "2025-10-13 00:15:23.855470"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated"}, "id" => "980190962"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Filter chain halted as :require_admin! rendered or redirected
Completed 403 Forbidden in 3ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated"}, "id" => "980190962"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 13], ["LIMIT", 1]]
  [1m[36mCACHE TeamComp Load (0.0ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 422 Unprocessable Content in 10ms (Views: 0.1ms | ActiveRecord: 0.3ms (2 queries, 1 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.882155"], ["updated_at", "2025-10-13 00:15:23.882155"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.885079"], ["updated_at", "2025-10-13 00:15:23.885079"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 1.3ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.898567"], ["updated_at", "2025-10-13 00:15:23.898567"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.901108"], ["updated_at", "2025-10-13 00:15:23.901108"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.9ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.909861"], ["updated_at", "2025-10-13 00:15:23.909861"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:15:23.913597"], ["updated_at", "2025-10-13 00:15:23.913597"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 17:15:23 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 18], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.4ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.4ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-13 00:15:23.919302"], ["updated_at", "2025-10-13 00:15:23.919302"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 5ms (Views: 0.3ms | ActiveRecord: 1.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.7ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-13 00:31:25.644634', '2025-10-13 00:31:25.644634', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-13 00:31:25.644634', '2025-10-13 00:31:25.644634', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-13 00:31:25.656320', '2025-10-13 00:31:25.656320', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-13 00:31:25.656320', '2025-10-13 00:31:25.656320', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::AuthControllerTest: test_login_returns_token_for_valid_credentials
-----------------------------------------------------------------------
  [1m[36mUser Delete All (2.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.770480"], ["updated_at", "2025-10-13 00:31:25.770480"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/api/auth/login" for 127.0.0.1 at 2025-10-12 17:31:25 -0700
Processing by Api::AuthController#login as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}}}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.3ms | ActiveRecord: 1.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
Api::AuthControllerTest: test_register_creates_user_and_returns_token
---------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
Started POST "/api/auth/register" for 127.0.0.1 at 2025-10-12 17:31:25 -0700
Processing by Api::AuthController#register as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.944508"], ["updated_at", "2025-10-13 00:31:25.944508"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 4ms (Views: 0.2ms | ActiveRecord: 1.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.951788"], ["updated_at", "2025-10-13 00:31:25.951788"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.954498"], ["updated_at", "2025-10-13 00:31:25.954498"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 17:31:25 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.4ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 11ms (Views: 0.4ms | ActiveRecord: 1.4ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mUser Delete All (0.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.977403"], ["updated_at", "2025-10-13 00:31:25.977403"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.981989"], ["updated_at", "2025-10-13 00:31:25.981989"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 17:31:25 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 24], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.5ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-13 00:31:25.988121"], ["updated_at", "2025-10-13 00:31:25.988121"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 5ms (Views: 0.2ms | ActiveRecord: 1.6ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.995650"], ["updated_at", "2025-10-13 00:31:25.995650"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:25.998142"], ["updated_at", "2025-10-13 00:31:25.998142"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 17:31:26 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.4ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.9ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
Api::TeamCompsControllerTest: test_update_requires_admin
--------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:26.008156"], ["updated_at", "2025-10-13 00:31:26.008156"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 00:31:26.010758"], ["updated_at", "2025-10-13 00:31:26.010758"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTeamComp Load (0.5ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.2ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 17:31:26 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated", "champion_ids" => [980190962, 298486374]}, "id" => "980190962"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 28], ["LIMIT", 1]]
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Filter chain halted as :require_admin! rendered or redirected
Completed 403 Forbidden in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE Champion Pluck (0.0ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 17:31:26 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated", "champion_ids" => [980190962, 298486374]}, "id" => "980190962"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 29], ["LIMIT", 1]]
  [1m[36mCACHE TeamComp Load (0.0ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.2ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Update (0.5ms)[0m  [1m[33mUPDATE "team_comps" SET "description" = $1, "updated_at" = $2, "win_rate" = $3, "play_rate" = $4 WHERE "team_comps"."id" = $5[0m  [["description", "Updated"], ["updated_at", "2025-10-13 00:31:26.026187"], ["win_rate", nil], ["play_rate", nil], ["id", 980190962]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 1.5ms (5 queries, 1 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 17:31:26 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.6ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 17:31:26 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "champions" DISABLE TRIGGER ALL;ALTER TABLE "team_comps" DISABLE TRIGGER ALL;ALTER TABLE "traits" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.3ms)[0m  [1m[31mDELETE FROM "champions";
DELETE FROM "team_comps";
INSERT INTO "champions" ("id", "name", "tier", "traits", "image_url", "created_at", "updated_at", "sprite_name", "sprite_x", "sprite_y", "sprite_w", "sprite_h") VALUES (980190962, 'Aatrox', 1, 'Vanguard / Slayer', 'tft-champion/TFT15_Aatrox.TFT_Set15.png', '2025-10-13 05:00:44.897076', '2025-10-13 05:00:44.897076', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT), (298486374, 'Kayle', 4, 'Redeemed / Slayer', 'tft-champion/TFT15_Kayle.TFT_Set15.png', '2025-10-13 05:00:44.897076', '2025-10-13 05:00:44.897076', DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT);
INSERT INTO "team_comps" ("id", "name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES (980190962, 'Vanguard Test', 'Fixture comp built for controller specs.', 'Aatrox, Kayle', '2025-10-13 05:00:44.908512', '2025-10-13 05:00:44.908512', 0.55, 0.12, 'Fixture data', 'fixture'), (298486374, 'Swiftshot Fixture', 'Secondary fixture team.', 'Kayle', '2025-10-13 05:00:44.908512', '2025-10-13 05:00:44.908512', 0.45, 0.08, 'Fixture data', 'fixture')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mALTER TABLE "champions" ENABLE TRIGGER ALL;ALTER TABLE "team_comps" ENABLE TRIGGER ALL;ALTER TABLE "traits" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
TeamCompTest: test_champion_names_returns_normalized_array
----------------------------------------------------------
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
TeamCompTest: test_validates_presence_of_name_and_champions
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
TeamCompTest: test_win_rate_value_converts_to_float
---------------------------------------------------
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
Api::ChampionsControllerTest: test_returns_single_champion
----------------------------------------------------------
  [1m[36mChampion Load (0.5ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/api/champions/980190962" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::ChampionsController#show as JSON
  Parameters: {"id" => "980190962", "champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
Api::ChampionsControllerTest: test_returns_champion_collection
--------------------------------------------------------------
Started GET "/api/champions" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::ChampionsController#index as JSON
  Parameters: {"champion" => {}}
  [1m[36mChampion Load (0.4ms)[0m  [1m[34mSELECT "champions".* FROM "champions" ORDER BY "champions"."tier" ASC, "champions"."name" ASC[0m
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mChampion Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
Api::TeamCompsControllerTest: test_create_comp_from_champion_ids
----------------------------------------------------------------
  [1m[36mUser Delete All (1.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.259835"], ["updated_at", "2025-10-13 05:00:45.259835"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.263158"], ["updated_at", "2025-10-13 05:00:45.263158"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Pluck (0.2ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
Started POST "/api/team_comps" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::TeamCompsController#create as JSON
  Parameters: {"team_comp" => {"name" => "Test From API", "description" => "Created via controller test", "champion_ids" => [980190962, 298486374], "win_rate" => 0.5, "play_rate" => 0.1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Create (0.4ms)[0m  [1m[32mINSERT INTO "team_comps" ("name", "description", "champions", "created_at", "updated_at", "win_rate", "play_rate", "notes", "source") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "Test From API"], ["description", "Created via controller test"], ["champions", "Aatrox, Kayle"], ["created_at", "2025-10-13 05:00:45.273184"], ["updated_at", "2025-10-13 05:00:45.273184"], ["win_rate", "0.5"], ["play_rate", "0.1"], ["notes", nil], ["source", nil]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.6ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 201 Created in 9ms (Views: 0.4ms | ActiveRecord: 2.0ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mChampion Count (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "champions"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
Api::TeamCompsControllerTest: test_update_requires_admin
--------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.287084"], ["updated_at", "2025-10-13 05:00:45.287084"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.289741"], ["updated_at", "2025-10-13 05:00:45.289741"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.1ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated", "champion_ids" => [980190962, 298486374]}, "id" => "980190962"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 32], ["LIMIT", 1]]
  [1m[36mTeamComp Load (0.2ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Filter chain halted as :require_admin! rendered or redirected
Completed 403 Forbidden in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mCACHE Champion Pluck (0.0ms)[0m  [1m[34mSELECT "champions"."id" FROM "champions"[0m
Started PATCH "/api/team_comps/980190962" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::TeamCompsController#update as JSON
  Parameters: {"team_comp" => {"description" => "Updated", "champion_ids" => [980190962, 298486374]}, "id" => "980190962"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 33], ["LIMIT", 1]]
  [1m[36mCACHE TeamComp Load (0.0ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" WHERE "team_comps"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mChampion Pluck (0.2ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" IN ($1, $2)[0m  [["id", 980190962], ["id", 298486374]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTeamComp Update (0.4ms)[0m  [1m[33mUPDATE "team_comps" SET "description" = $1, "updated_at" = $2, "win_rate" = $3, "play_rate" = $4 WHERE "team_comps"."id" = $5[0m  [["description", "Updated"], ["updated_at", "2025-10-13 05:00:45.297616"], ["win_rate", nil], ["play_rate", nil], ["id", 980190962]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 1.1ms (5 queries, 1 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_index_returns_serialized_comps_with_cards
----------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.303872"], ["updated_at", "2025-10-13 05:00:45.303872"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.306599"], ["updated_at", "2025-10-13 05:00:45.306599"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/team_comps" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::TeamCompsController#index as JSON
  Parameters: {"team_comp" => {}}
  [1m[36mTeamComp Load (0.6ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC LIMIT $1[0m  [["LIMIT", 50]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" = $1 AND "champions"."name" IN ('Kayle') ORDER BY CASE WHEN "champions"."name" = 'Kayle' THEN 1 END ASC[0m  [["name", "Kayle"]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTeamComp Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "team_comps"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::TeamCompsControllerTest: test_recommendations_include_match_metadata
-------------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.317385"], ["updated_at", "2025-10-13 05:00:45.317385"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.320200"], ["updated_at", "2025-10-13 05:00:45.320200"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mChampion Load (0.2ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/api/team_comps/recommendations" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::TeamCompsController#recommendations as JSON
  Parameters: {"include_cards" => [980190962], "team_comp" => {}}
  [1m[36mChampion Pluck (0.3ms)[0m  [1m[34mSELECT "champions"."name" FROM "champions" WHERE "champions"."id" = $1[0m  [["id", 980190962]]
  [1m[36mTeamComp Load (0.3ms)[0m  [1m[34mSELECT "team_comps".* FROM "team_comps" ORDER BY "team_comps"."win_rate" DESC, "team_comps"."created_at" DESC[0m
  [1m[36mChampion Load (0.3ms)[0m  [1m[34mSELECT "champions".* FROM "champions" WHERE "champions"."name" IN ($1, $2) AND "champions"."name" IN ('Aatrox', 'Kayle') ORDER BY CASE WHEN "champions"."name" = 'Aatrox' THEN 1 WHEN "champions"."name" = 'Kayle' THEN 2 END ASC[0m  [["name", "Aatrox"], ["name", "Kayle"]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.8ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
Api::AuthControllerTest: test_register_creates_user_and_returns_token
---------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
Started POST "/api/auth/register" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::AuthController#register as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]", "password_confirmation" => "[FILTERED]"}}}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "user"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.333168"], ["updated_at", "2025-10-13 05:00:45.333168"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 7ms (Views: 0.3ms | ActiveRecord: 1.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
Api::AuthControllerTest: test_login_returns_token_for_valid_credentials
-----------------------------------------------------------------------
  [1m[36mUser Delete All (0.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password_digest", "role", "display_name", "bio", "location", "avatar_url", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["email", "[FILTERED]"], ["password_digest", "[FILTERED]"], ["role", "admin"], ["display_name", nil], ["bio", nil], ["location", nil], ["avatar_url", nil], ["created_at", "2025-10-13 05:00:45.343183"], ["updated_at", "2025-10-13 05:00:45.343183"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/api/auth/login" for 127.0.0.1 at 2025-10-12 22:00:45 -0700
Processing by Api::AuthController#login as JSON
  Parameters: {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}, "auth" => {"user" => {"email" => "[FILTERED]", "password" => "[FILTERED]"}}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
